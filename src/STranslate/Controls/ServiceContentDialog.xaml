<ui:ContentDialog
    x:Class="STranslate.Controls.ServiceContentDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvt="clr-namespace:STranslate.Converters"
    xmlns:control="clr-namespace:STranslate.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:plugin="clr-namespace:STranslate.Plugin;assembly=STranslate.Plugin"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    d:DataContext="{d:DesignInstance control:ServiceContentDialog,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    CloseButtonText="{DynamicResource Cancel}"
    Closed="OnClosed"
    IsPrimaryButtonEnabled="{Binding SelectedItem, Converter={cnvt:NullToBoolInverseConverter}}"
    KeyDown="OnKeyDown"
    PrimaryButtonStyle="{DynamicResource {x:Static ui:ThemeKeys.AccentButtonStyleKey}}"
    PrimaryButtonText="{DynamicResource Add}"
    mc:Ignorable="d">

    <ui:ContentDialog.Resources>
        <sys:Double x:Key="ContentDialogMaxWidth">800</sys:Double>
        <sys:Double x:Key="ContentDialogMaxHeight">600</sys:Double>
        <sys:Double x:Key="ContentDialogMinWidth">800</sys:Double>
        <sys:Double x:Key="ContentDialogMinHeight">600</sys:Double>

        <Thickness x:Key="ContentDialogTitleMargin">0</Thickness>
    </ui:ContentDialog.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <DockPanel Grid.Row="0" Margin="4,0,0,12">
            <TextBlock
                DockPanel.Dock="Left"
                Style="{DynamicResource {x:Static ui:ThemeKeys.SubtitleTextBlockStyleKey}}"
                Text="{Binding ServiceTitle}" />

            <ikw:SimpleStackPanel
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                DockPanel.Dock="Right"
                Orientation="Horizontal"
                Spacing="10">
                <TextBlock
                    Margin="6,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="{DynamicResource {x:Static ui:ThemeKeys.ControlContentThemeFontSizeKey}}"
                    Foreground="{DynamicResource {x:Static ui:ThemeKeys.TextFillColorSecondaryBrushKey}}">
                    <Run Text="{DynamicResource FilterService}" />
                    <Run Text=":" />
                </TextBlock>
                <TextBox
                    x:Name="PART_FilterTextBox"
                    Width="150"
                    Height="34"
                    Margin="0,0,26,0"
                    ui:ControlHelper.PlaceholderText="{DynamicResource SearchService}"
                    Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                    TextAlignment="Left"
                    ToolTip="{DynamicResource SearchServiceTooltip}"
                    ToolTipService.InitialShowDelay="200"
                    ToolTipService.Placement="Top" />
            </ikw:SimpleStackPanel>
        </DockPanel>

        <ListBox
            Grid.Row="1"
            Background="Transparent"
            ItemsSource="{Binding CollectionView}"
            SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
            <ListBox.Resources>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                                <ContentPresenter />
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListBox.Resources>
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBox.ItemTemplate>
                <DataTemplate DataType="plugin:PluginMetaData">
                    <Border
                        x:Name="SvcCard"
                        MinWidth="{DynamicResource SettingsCardMinWidth}"
                        MinHeight="50"
                        Margin="4"
                        Padding="16,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        Background="{DynamicResource SettingsCardBackground}"
                        BorderBrush="{DynamicResource SettingsCardBorderBrush}"
                        BorderThickness="{DynamicResource SettingsCardBorderThickness}"
                        CornerRadius="{DynamicResource ControlCornerRadius}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="24" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Image Source="{Binding IconPath}" />
                            <TextBlock
                                Grid.Column="1"
                                Margin="5,0,0,0"
                                VerticalAlignment="Center"
                                Text="{Binding Name}"
                                ToolTipService.ToolTip="{Binding Name}" />
                            <control:Badge
                                Grid.Column="2"
                                Margin="3,0"
                                IsOfficial="{Binding IsPrePlugin}" />
                        </Grid>
                    </Border>
                    <DataTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="SvcCard" Property="Background" Value="{DynamicResource SystemFillColorAttentionBackgroundBrush}" />
                        </Trigger>
                        <DataTrigger Binding="{Binding Path=IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}}" Value="True">
                            <Setter TargetName="SvcCard" Property="Background" Value="{DynamicResource CardStrokeColorDefaultBrush}" />
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</ui:ContentDialog>
